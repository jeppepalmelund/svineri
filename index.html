<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function formatDKK(n){
    return n.toLocaleString('da-DK',{style:'currency',currency:'DKK',maximumFractionDigits:0});
  }

  document.getElementById('calc').addEventListener('click',()=>{

    const income = Number(document.getElementById('income').value)||0;

    // Data
    const total_support = 7000000000 + 15000000000 + 5500000000; // Landbrugsstøtte + stat + skattefordel
    const environmental_damage = 30000000000; // Miljø og klima

    // Samlet skattepligtig indkomst i DK 2024 (estimat)
    const total_income = 2300000000000;

    // Beregn andel af indkomst
    const income_share = income / total_income;

    // Din andel af støtte og miljøomkostninger
    const din_andel_support = total_support * income_share;
    const din_andel_env = environmental_damage * income_share;
    const din_andel_total = din_andel_support + din_andel_env;

    // Andel i procent af din indkomst
    const total_pct_income = income>0 ? (din_andel_total/income)*100 : 0;

    // Vis resultat
    const out = document.getElementById('output');
    out.hidden = false;
    out.innerHTML = `
      <h3>Resultat</h3>
      <p>Samlet støtte til animalsk landbrug: <strong>${formatDKK(total_support)}</strong></p>
      <p>Miljø- og klimapåvirkning (økonomisk værdi): <strong>${formatDKK(environmental_damage)}</strong></p>
      <p>Din andel: <strong>${formatDKK(din_andel_total)}</strong> (<strong>${total_pct_income.toFixed(2)} %</strong> af din indkomst)</p>
    `;

    // Chart
    const ctx = document.getElementById('chart').getContext('2d');
    if(window.barChart) window.barChart.destroy();
    window.barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Landbrugsstøtte', 'Statslige udgifter', 'Skattefordele', 'Miljø- og klimapåvirkning'],
        datasets: [{
          label: 'Årlig økonomisk værdi (mia. kr.)',
          data: [7, 15, 5.5, 30],
          backgroundColor: ['#0ea5a4','#14b8a6','#2dd4bf','#94a3b8']
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Mia. kr.' } }
        },
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Samlede udgifter og skader fra animalsk kødproduktion (2024)' }
        }
      }
    });
  });
</script>
