<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function formatDKK(n){
    return n.toLocaleString('da-DK',{style:'currency',currency:'DKK',maximumFractionDigits:0});
  }

  document.getElementById('calc').addEventListener('click', ()=> {

    const income = Number(document.getElementById('income').value) || 0;

    // Gennemsnitlig skattesats i Danmark (eksempel)
    const avg_tax_rate = 0.35; 
    const tax_paid = income * avg_tax_rate;

    // Samlede støtte + miljøomkostning
    const direct_support = 7000000000;
    const state_expenses = 15000000000;
    const tax_benefits = 5500000000;
    const environmental_damage = 30000000000;
    const total_cost = direct_support + state_expenses + tax_benefits + environmental_damage;

    // Estimeret samlet skattebetaling i DK 2024 (eksempel)
    const total_tax_collected = 1000000000000;

    // Din andel proportional med skattebetaling
    const din_andel = (tax_paid / total_tax_collected) * total_cost;

    // Andel i procent af din indkomst
    const total_pct_income = income > 0 ? (din_andel / income) * 100 : 0;

    // Vis resultat
    const out = document.getElementById('output');
    out.hidden = false;
    out.innerHTML = `
      <h3>Resultat</h3>
      <p>Samlet støtte til animalsk landbrug: <strong>${formatDKK(direct_support + state_expenses + tax_benefits)}</strong></p>
      <p>Miljø- og klimapåvirkning (økonomisk værdi): <strong>${formatDKK(environmental_damage)}</strong></p>
      <p>Din andel: <strong>${formatDKK(din_andel)}</strong> (<strong>${total_pct_income.toFixed(2)} %</strong> af din indkomst)</p>
    `;

    // Chart
    const ctx = document.getElementById('chart').getContext('2d');
    if(window.barChart) window.barChart.destroy();
    window.barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Landbrugsstøtte', 'Statslige udgifter', 'Skattefordele', 'Miljø- og klimapåvirkning'],
        datasets: [{
          label: 'Årlig økonomisk værdi (mia. kr.)',
          data: [7, 15, 5.5, 30],
          backgroundColor: ['#0ea5a4','#14b8a6','#2dd4bf','#94a3b8']
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Mia. kr.' } }
        },
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Samlede udgifter og skader fra animalsk kødproduktion (2024)' }
        }
      }
    });

  });
</script>
